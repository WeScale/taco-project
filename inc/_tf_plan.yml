---
- include_tasks: "{{ playbook_dir }}/inc/_tf_init.yml"

- set_fact:
    plan_command_line: >-
      terraform plan {{ tf_common_options }}

- debug:
    var: plan_command_line
    verbosity: 1

- name: "{{ tflayer }} - plan"
  command: >-
    {{ plan_command_line }}
  args:
    chdir: "{{ src_layer_dir }}"
  register: tf_plan

- pause:
    prompt: |-
      {{ tf_plan.stdout }}
      #
      ##
      ###
      #### READ CAREFULLY !!!
      Press 'ENTER' to continue
  register: tf_plan_prompt
  when:
    - not (auto_apply|default(false))
    - not dry_run|bool

- name: displaying plan
  debug:
    msg: "{{ tf_plan.stdout }}"
  when: auto_apply|default(false)
